<PlusConfiguration version="2.1">

  <DataCollection StartupDelaySec="1.0" >

    <DeviceSet 
      Name="SonixTouch with Fake tracker (UBC)" 
      Description="SonixTouch and Fake tracker. The SonixTouch US device should be in research mode. Used at UBC" />

    <xDevice
      Id="TrackerDevice"
      Type="FakeTracker"
      AcquisitionRate="30"
      LocalTimeOffsetSec="0.0"
      DefaultToolName="Stylus"
      Mode="PivotCalibration"
      ReferenceToolName="Reference"
      ToolReferenceFrame="Tracker" >
      <DataSources>
        <DataSource Type="Tool" Id="Reference" PortName="0" BufferSize="200" AveragedItemsForFiltering="20"/>
        <DataSource Type="Tool" Id="Stylus" PortName="1" BufferSize="200" AveragedItemsForFiltering="20"/>
      </DataSources>  
      <OutputChannels>
        <OutputChannel Id="TrackerStream" >
          <DataSource Id="Reference"/>
          <DataSource Id="Stylus"/>
        </OutputChannel>
      </OutputChannels>
    </xDevice>

    <Device
      Type="SonixVideo"
      Id="DeviceSonixVideo" 
      IP="130.15.7.20" 
      AcquisitionDataType="BPost" 
      Depth="-1" 
      Sector="-1" 
      Gain="-1" 
      DynRange="-1" 
      Zoom="-1" 
      Frequency="-1" 
      Timeout="-1" 
      CompressionStatus="0" >
      <DataSources>
        <DataSource Type="Video" Id="Video" PortName="B" PortUsImageOrientation="MF" BufferSize="500" AveragedItemsForFiltering="20" />
      </DataSources>      
      <OutputChannels>
        <OutputChannel Id="VideoStream" VideoDataSourceId="Video" />
      </OutputChannels>
    </Device>

    <Device 
      Id="TrackedVideoDevice" 
      Type="VirtualMixer" >
      <InputChannels>
        <InputChannel Id="TrackerStream" />
        <InputChannel Id="VideoStream" />
      </InputChannels>
      <OutputChannels>
        <OutputChannel Id="TrackedVideoStream"/>
      </OutputChannels>
    </Device>
    
  </DataCollection>

  <fCal
    PhantomModelId="PhantomModel"
    TransducerModelId="ProbeModel"
    StylusModelId="StylusModel"
    ImageDisplayableObjectId="LiveImage"
    NumberOfCalibrationImagesToAcquire="200"
    NumberOfValidationImagesToAcquire="100"
    NumberOfStylusCalibrationPointsToAcquire="200"
    RecordingIntervalMs="100"
    MaxTimeSpentWithProcessingMs="70"
    ImageCoordinateFrame="Image"
    ProbeCoordinateFrame="Probe"
    ReferenceCoordinateFrame="Reference"
    TransducerOriginCoordinateFrame="TransducerOrigin"
    TransducerOriginPixelCoordinateFrame="TransducerOriginPixel"
    TemporalCalibrationDurationSec="10" />

  <xCoordinateDefinitions>
    <Transform From="Image" To="Probe"
      Matrix="
        -0.0683412  -0.0064516  0.0417947  16.3721
        0.0434727  0.00290642  0.0658372  -27.4971
        -0.00553304  0.0744595  0.00105147  48.8042
        0  0  0  1"
       Error="0.475259" Date="060612_154721"/>
    <Transform From="Image" To="TransducerOriginPixel"
      Matrix="
        1  0  0  -410
        0  1  0  5
        0  0  1  0
        0  0  0  1"
       Date="2011.12.06 17:57:00"/>
    <Transform From="Phantom" To="Reference"
      Matrix="
        -0.339698  0.940469  0.0110627  -6.53095
        0.939399  0.339842  -0.0451359  -94.2699
        -0.0462085  -0.0049403  -0.99892  14.0551
        0  0  0  1"
       Error="0.600242" Date="060612_154610"/>
    <Transform From="StylusTip" To="Stylus"
      Matrix="
        0.035089  0.000562193  -0.999384  1.52424
        -0.0160199  0.999872  0  -0.695891
        0.999256  0.01601  0.0350935  43.4069
        0  0  0  1"
       Error="0.202318" Date="060612_154516"/>
    <Transform From="TransducerOriginPixel" To="TransducerOrigin"
      Matrix="
        0.0813304  0  0  0
        0  0.0746369  0  0
        0  0  0.07799  0
        0  0  0  1"
       Date="060612_154723"/>
  </xCoordinateDefinitions>

  <ProstateBiopsy AcquisitionTime="3" />

</PlusConfiguration>
