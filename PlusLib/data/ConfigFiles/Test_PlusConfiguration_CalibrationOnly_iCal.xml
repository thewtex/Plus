<PlusConfiguration version="1.2">

  <USDataCollection version="2.0" StartupDelaySec="1.0">

    <Tracker Type="BrachyTracker" BufferSize="1000" Frequency="20" AveragedItemsForFiltering="20" LocalTimeOffset="0.0" SerialPort="3" BaudRate="19200" BrachyStepperType="Burdette Medical Systems Digital Stepper" ModelNumber="4012A18-a" ModelVersion="" ModelSerialNumber="01-50-149"
      MaxAllowedTranslationSpeedMmPerSec="10.0"
      MaxAllowedRotationSpeedDegPerSec="15.0"
      MinRequiredTranslationDifferenceMm="0.5"
      MinRequiredAngleDifferenceDeg="5.0">
    
        <StepperCalibration AlgorithmVersion="1.0.0" Date="2011.05.02" ProbeTranslationAxisOrientation="0.004635 -0.053440 1" TemplateTranslationAxisOrientation="-0.003557 0.031474 1" Rx="" Ry="" Rx0="" Ry0="" ProbeRotationEncoderScale="1.0" />
        <Tool PortNumber="0" Type="Probe" Name="ProbeHomeToProbe" SendTo="127.0.0.1:1111">
            <Calibration 
                MatrixName="ImageToProbe" 
                MatrixValue="1 0 0 0 
                             0 1 0 0 
                             0 0 1 0
                             0 0 0 1" 
                Date="2011.05.02"
                Error="0.0"
            /> 
        </Tool>
    </Tracker>

    <ImageAcquisition Type="None" />

    <Synchronization Type="None" />
	</USDataCollection>

	<USCalibration version="1.0">
		<CalibrationController LogLevel="INFO" OutputPath="./Output" EnableTrackedSequenceDataSaving="FALSE" EnableErroneouslySegmentedDataSaving="FALSE" EnableSegmentationAnalysis="FALSE" >
			<StepperCalibration MinNumberOfRotationClusters="1" >
				<!-- TemplateTranslationData: These are the data files used to calculate the template translation axis  -->
				<TemplateTranslationData 
                        NumberOfImagesToAcquire="100" 
                        OutputSequenceMetaFileSuffix=".TemplateTranslationData"
						/>

				<!-- ProbeTranslationData: These are the data files used to calculate the stepper translation axis  -->
				<ProbeTranslationData 
                        NumberOfImagesToAcquire="200" 
                        OutputSequenceMetaFileSuffix=".ProbeTranslationData"
						/>
				 <!-- ProbeRotationData: These are the data files used to calculate the frame center of rotation  -->
				<ProbeRotationData 
                        NumberOfImagesToAcquire="500" 
                        OutputSequenceMetaFileSuffix=".ProbeRotationData"
						/>
			</StepperCalibration>	
			
			<ProbeCalibration
					EnableSegmentedWirePositionsSaving="FALSE"
					ImageHomeToUserImageHomeTransform=" 1  0  0  0 
														0  1  0  0 
														0  0  1  0 
														0  0  0  1"
					DataFileSuffix=".data"
					CalibrationResultFileSuffix=".Calibration.results"
					SegmentationErrorLogFileNameSuffix=".Segmentation.errors"
					SegmentationAnalysisFileNameSuffix = ".Segmentation.analysis"
					Temp2StepCalibAnalysisFileNameSuffix = ".Template2StepperCalibration.analysis"
					>
				
				 <!-- RandomStepperMotionData1: These are the data files used for calibration. -->
				<RandomStepperMotionData1
                        NumberOfImagesToAcquire="300" 
                        OutputSequenceMetaFileSuffix=".RandomStepperMotionData1"
						/>

				<!-- RandomStepperMotionData2: These are the data files used to validate the calibration accuracy.  -->
				<RandomStepperMotionData2
                        NumberOfImagesToAcquire="200" 
                        OutputSequenceMetaFileSuffix=".RandomStepperMotionData2"
						/>

				<TemplateModel ConfigFile="TemplateModel.xml" >
				</TemplateModel>

				<!-- IncorporatingUS3DBeamProfile: 0 - NO | 1 - BeamwidthVariance | 2 - BeamwidthRatio | 3 - BeamwidthVarianceAndThresholding -->
				<!-- ConfigFile: The name and the relative or absolute path of the US beam profile file -->
				<US3DBeamProfile IncorporatingUS3DBeamProfile="0" ConfigFile="./Component_US3DBeamProfile.config" />
			</ProbeCalibration>
			
			<SegmentationParameters
					ApproximateSpacingMmPerPixel="0.19"
					MorphologicalOpeningCircleRadiusMm="0.55"
					MorphologicalOpeningBarSizeMm="2.0"
					
					RegionOfInterest="50 40 600 340" 

					MaxLineLengthErrorPercent="5.0"
					MaxLinePairDistanceErrorPercent="10.0"
					MaxLineErrorMm="2.0"

					MaxAngleDifferenceDegrees="11"
					MinThetaDegrees="20"
					MaxThetaDegrees="160"
					
					ThresholdImagePercent="10.0"

					CollinearPointsMaxDistanceFromLineMm="1.0"

					UseOriginalImageIntensityForDotIntensityScore="0"
					>
			</SegmentationParameters>
		</CalibrationController>
	</USCalibration>

	<PhantomDefinition version="1.0">
		<!-- Supported types are: Double-N, U-Shaped-N -->
		<Description
			Name="iCAL"
			Type="Double-N"
			Version="1.0"
			Institution="Queen's University PerkLab"
		/>
		
		<!-- ModelToPhantomTransform - transforming model into phantom coordinate system for proper visualization -->
		<Model
			File="?"
			ModelToPhantomTransform="
				1 0 0 0.0
				0 1 0 0.0
				0 0 1 0.0
				0 0 0 1"
		/>

		<Geometry>
			<!-- N wire definitions -->
			<!-- Phantom origin is the inner end of the hole that is on the side of the templete holder, on the side of the triangle shaped hole on the inner part, and closest to the probe -->
			<NWire>
				<Wire Id="1" Name="wire4" EndPointFront="49.86 54.385 62.05" EndPointBack="49.86 54.385 142.05" />
				<Wire Id="2" Name="wire5" EndPointFront="39.86 54.385 62.05" EndPointBack="19.86 54.385 142.05" />
				<Wire Id="3" Name="wire6" EndPointFront="9.86 54.385 62.05" EndPointBack="9.86 54.385 142.05" />
			</NWire>
			<NWire>
				<Wire Id="4" Name="wire1" EndPointFront="49.86 34.385 62.05" EndPointBack="49.86 34.385 142.05" />
				<Wire Id="5" Name="wire2" EndPointFront="19.86 34.385 62.05" EndPointBack="39.86 34.385 142.05" />
				<Wire Id="6" Name="wire3" EndPointFront="9.86 34.385 62.05" EndPointBack="9.86 34.385 142.05" />
			</NWire>

			<!-- Landmark list for registration -->
			<Landmarks>
				<Landmark Name="?" Position="0.0 0.0 0.0" />
			</Landmarks>

			<Registration
				MatrixName="PhantomToPhantomReference" 
				MatrixValue="1 0 0 0 
							 0 1 0 0 
							 0 0 1 0
							 0 0 0 1" 
				Date=""
				Error="0.0" />
		</Geometry>

	  <CustomTransforms TemplateHolderToPhantomTransform="
					1 0 0 5
					0 1 0 63.5
					0 0 1 0
					0 0 0 1" />

	</PhantomDefinition>

</PlusConfiguration>
