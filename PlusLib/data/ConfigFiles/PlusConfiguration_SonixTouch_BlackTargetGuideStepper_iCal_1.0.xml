<PlusConfiguration version="1.2">

    <USDataCollection version="2.0" StartupDelaySec="1.0">
		<DeviceSet 
			Name="SonixTouch TRUS probe + Burdette Medical Systems Digital Stepper (01-50-149) + 70mm depth" 
			Description="Configuration file for SonixTouch TRUS + Burdette Medical Systems Digital Stepper + iCal 1.0 + 70mm depth" 
			/>

        <Tracker Type="BrachyTracker" BufferSize="1000" Frequency="20" AveragedItemsForFiltering="20" LocalTimeOffset="0.0" SerialPort="3" BaudRate="19200" BrachyStepperType="Burdette Medical Systems Digital Stepper" ModelNumber="4012A18-a" ModelVersion="" ModelSerialNumber="01-50-149">
        
            <StepperCalibration AlgorithmVersion="1.0.0" Date="2011.05.02" ProbeTranslationAxisOrientation="0.004635 -0.053440 1" TemplateTranslationAxisOrientation="-0.003557 0.031474 1" Rx="" Ry="" Rx0="" Ry0="" ProbeRotationEncoderScale="1.0" />
            <Tool PortNumber="0" Type="Probe" Name="ProbeHomeToProbe" SendTo="127.0.0.1:1111">
                <Calibration 
                    MatrixName="ImageToProbe" 
                    MatrixValue="1 0 0 0 
                                 0 1 0 0 
                                 0 0 1 0
                                 0 0 0 1" 
                    Date="2011.05.02"
                    Error="0.0"
                /> 
            </Tool>
        </Tracker>
 
            
        <ImageAcqusition Type="SonixVideo" 
          BufferSize="500" 
          FrameSize="820 616" 
          UsImageOrientation="UF"
          FrameRate="30" 
          AveragedItemsForFiltering="20" 
          LocalTimeOffset="-0.2126"
          IP="130.15.7.20" 
          ImagingMode="0" 
          AcquisitionDataType="4" 
          Depth="-1" 
          Sector="-1" 
          Gain="-1" 
          DynRange="-1" 
          Zoom="-1" 
          Frequency="-1" 
          Timeout="-1" 
          CompressionStatus="0" 
				/>
 
        <Synchronization Type="ChangeDetection" 
          SynchronizationTimeLength="30" 
          MinNumOfSyncSteps="5" 
          ThresholdMultiplier="5"

          NumberOfAveragedTransforms="20" 
          MinTransformThreshold="2.0" 
          MaxTransformDifference="2.0" 

          NumberOfAveragedFrames="6" 
          MinFrameThreshold="200.0" 
          MaxFrameDifference="10.0" 
				/>
	</USDataCollection>
	<USCalibration version="1.0">
		<CalibrationController LogLevel="INFO" OutputPath="./Output" EnableTrackedSequenceDataSaving="FALSE" EnableErroneouslySegmentedDataSaving="FALSE" EnableSegmentationAnalysis="FALSE">
      <StepperCalibration MinNumberOfRotationClusters="1" >
          <!-- TemplateTranslationData: These are the data files used to calculate the template translation axis  -->
          <TemplateTranslationData 
                  NumberOfImagesToAcquire="50" 
                  OutputSequenceMetaFileSuffix=".TemplateTranslationData"
                  />
          <!-- ProbeTranslationData: These are the data files used to calculate the stepper translation axis  -->
          <ProbeTranslationData 
                  NumberOfImagesToAcquire="50" 
                  OutputSequenceMetaFileSuffix=".ProbeTranslationData"
                  />
           <!-- ProbeRotationData: These are the data files used to calculate the frame center of rotation  -->
          <ProbeRotationData 
                  NumberOfImagesToAcquire="50" 
                  OutputSequenceMetaFileSuffix=".ProbeRotationData"
                  />
			</StepperCalibration>	
			
			<ProbeCalibration
					EnableLogFile="FALSE"  
					EnableSegmentedWirePositionsSaving="FALSE"
					ImageHomeToUserImageHomeTransform=" 1  0  0  0 
														0  1  0  0 
														0  0  1  0 
														0  0  0  1"
					DataFileSuffix=".data"
					CalibrationResultFileSuffix=".Calibration.results"
					SegmentationErrorLogFileNameSuffix=".Segmentation.errors"
					SegmentationAnalysisFileNameSuffix = ".Segmentation.analysis"
					Temp2StepCalibAnalysisFileNameSuffix = ".Template2StepperCalibration.analysis"
					>
				
        <!-- RandomStepperMotionData1: These are the data files used for calibration. -->
        <RandomStepperMotionData1
                NumberOfImagesToAcquire="50" 
                OutputSequenceMetaFileSuffix=".RandomStepperMotionData1"
                />
        <!-- RandomStepperMotionData2: These are the data files used to validate the calibration accuracy.  -->
        <RandomStepperMotionData2
                NumberOfImagesToAcquire="50" 
                OutputSequenceMetaFileSuffix=".RandomStepperMotionData2"
                />

				<TemplateModel ConfigFile="TemplateModel.xml" >
				</TemplateModel>

				<!-- IncorporatingUS3DBeamProfile: 0 - NO | 1 - BeamwidthVariance | 2 - BeamwidthRatio | 3 - BeamwidthVarianceAndThresholding -->
				<!-- ConfigFile: The name and the relative or absolute path of the US beam profile file -->
				<US3DBeamProfile IncorporatingUS3DBeamProfile="0" ConfigFile="./Component_US3DBeamProfile.config" />
			</ProbeCalibration>
			
			<SegmentationParameters
					FrameSize="820 616"
					ScalingEstimation="0.145"
					MorphologicalOpeningCircleRadiusMm="0.47"
					MorphologicalOpeningBarSizeMm="2.0"

					RegionOfInterest="90 70 730 430"

					MaxLineLengthErrorPercent="10.0"
					MaxLinePairDistanceErrorPercent="10.0"
					MaxLineErrorMm="2.0"

					MaxAngleDifferenceDegrees="11"
					MinThetaDegrees="20"
					MaxThetaDegrees="160"
					
					ThresholdImage="10.0"

					FindLines3PtDist="5.3"

					UseOriginalImageIntensityForDotIntensityScore="0"
					>
			</SegmentationParameters>
		</CalibrationController>
	</USCalibration>

	<PhantomDefinition version="1.0">
		<!-- Supported types are: Double-N, U-Shaped-N -->
		<Description
			Name="iCAL"
			Type="Double-N"
			Version="1.0"
			Institution="Queen's University PerkLab"
		/>
		
		<!-- ModelToPhantomTransform - transforming model into phantom coordinate system for proper visualization -->
		<Model
			File="DoubleN-EG-Phantom-SolidEdge_DemoVersionSinglePiece_v1.0_R3-EngravedByCarolyn.stl"
			ModelToPhantomTransform="
                        -1 0 0 36.5
                         0 0 -1 58
                         0 -1 0 61
                         0 0 0 1"
		/>

		<Geometry>
			<!-- N wire definitions -->
			<!-- Phantom origin is the inner end of the hole that is on the side of the templete holder, on the side of the triangle shaped hole on the inner part, and closest to the probe -->
			<NWire>
				<Wire Id="1" Name="wire4" EndPointFront="49.86 54.385 62.05" EndPointBack="49.86 54.385 142.05" />
				<Wire Id="2" Name="wire5" EndPointFront="39.86 54.385 62.05" EndPointBack="19.86 54.385 142.05" />
				<Wire Id="3" Name="wire6" EndPointFront="9.86 54.385 62.05" EndPointBack="9.86 54.385 142.05" />
			</NWire>
			<NWire>
				<Wire Id="4" Name="wire1" EndPointFront="49.86 34.385 62.05" EndPointBack="49.86 34.385 142.05" />
				<Wire Id="5" Name="wire2" EndPointFront="19.86 34.385 62.05" EndPointBack="39.86 34.385 142.05" />
				<Wire Id="6" Name="wire3" EndPointFront="9.86 34.385 62.05" EndPointBack="9.86 34.385 142.05" />
			</NWire>

			<!-- Landmark list for registration -->
			<Landmarks>
				<Landmark Name="?" Position="0.0 0.0 0.0" />
			</Landmarks>

			<Registration
				MatrixName="PhantomToPhantomReference" 
				MatrixValue="1 0 0 0 
							 0 1 0 0 
							 0 0 1 0
							 0 0 0 1" 
				Date="2011.05.17"
				Error="0.0" />
		</Geometry>

	  <CustomTransforms TemplateHolderToPhantomTransform="
					1 0 0 5
					0 1 0 63.5
					0 0 1 0
					0 0 0 1" />

	</PhantomDefinition>

	<!-- VOLUME RECONSTRUCTION -->
	<VolumeReconstruction>
		<SliceParameters SliceSpacing="1 1 1" SliceOrigin="0 0 0" NumScalarComponents="1" />

		<OutputParameters OutputSpacing="0.5 0.5 0.5" />

		<ClippingParameters ClipRectangle="0 0 820 616"/>
		<FanParameters FanAngles="0 0" FanOrigin="0 0" FanDepth="300"/>
		<RotationOptions ImageFlipped="Off" Rotation="Off" MaxRotationChange="90" Threshold1="0" Threshold2="255" ShiftX="0" ShiftY="0" />
		<ReconstructionOptions Interpolation="Linear" Optimization="On" Compounding="On"/>
	</VolumeReconstruction>

</PlusConfiguration>
