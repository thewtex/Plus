<PlusConfiguration version="2.0">

  <DataCollection StartupDelaySec="1.0" DefaultSelectedDeviceId="TrackedVideoDevice" >
    <DeviceSet 
      Name="TEST Epiphan framegrabber with Fake tracker" 
      Description="Test mode for vtkDataCollectorTest with Epiphan framegrabber and Fake tracker" 
    />

    <Device
      Id="TrackerDevice"
      Type="FakeTracker"
      AcquisitionRate="20"
      LocalTimeOffset="0.0"
      Mode="SmoothMove" >
      <Tool Name="Probe" PortName="0" BufferSize="1000" AveragedItemsForFiltering="20"/> 
      <Tool Name="Reference" PortName="1" BufferSize="1000" AveragedItemsForFiltering="20"/>
      <Tool Name="MissingTool" PortName="2" BufferSize="1000" AveragedItemsForFiltering="20"/>       
      <OutputStream Id="TrackerStream" >
        <Tool Name="Probe"/>
        <Tool Name="Reference"/>
        <Tool Name="MissingTool"/>
      </OutputStream>
    </Device>

    <Device
      Id="VideoDevice" 
      Type="Epiphan"
      AcquisitionRate="30" 
      UsImageOrientation="MF" >
      <Image Id="Video" BufferSize="500" AveragedItemsForFiltering="20" />
      <OutputStream Id="VideoStream">
        <Image Id="Video"/>
      </OutputStream>
    </Device>

    <Device Id="TrackedVideoDevice" Type="VirtualStreamMixer">
      <InputStream Id="TrackerStream" />
      <InputStream Id="VideoStream" />
      <OutputStream Id="TrackedVideoStream"/>
    </Device>
    
  </DataCollection>

 <CoordinateDefinitions>
    <Transform From="Image" To="Probe"
      Matrix="0.00156166 0.0726639 -0.00948114 11.3389 
      -0.0779562 0.00257007 0.00812248 46.115 
      0.00866095 0.00892904 0.074819 -7.23141 
      0 0 0 1" 
      />
    <Transform From="Phantom" To="Reference" Matrix="0.00898765 -0.0136951 -0.999866 9.59137 0.0246163 -0.9996 0.0139127 36.0012 -0.999657 -0.024738 -0.00864693 87.8909 0 0 0 1" Error="0.404711" Date="012712_152104" />
  </CoordinateDefinitions>
    
  <Rendering WorldCoordinateFrame="Reference">
    <!-- TODO EC9 model and proper transform -->
    <xDisplayableObject Type="Model" ObjectCoordinateFrame="Probe" Id="ProbeModel"
      File="L14-5_38_ProbeModel.stl"
      ModelToObjectTransform="
        -1 0 0 29.7
        0 -1 0 1.5
        0 0 1 -14
        0 0 0 1"
    />
    <DisplayableObject Type="Image" ObjectCoordinateFrame="Image" Id="LiveImage"/>
  </Rendering>

  <fCal
    PhantomModelId="PhantomModel"
  TransducerModelId="ProbeModel"
  StylusModelId="StylusModel"
  ImageDisplayableObjectId="LiveImage"
    NumberOfStylusCalibrationPointsToAcquire="200"
    ImageCoordinateFrame="Image"
    ProbeCoordinateFrame="Probe"
    ReferenceCoordinateFrame="Reference"
    TransducerOriginCoordinateFrame="TransducerOrigin"
    TransducerOriginPixelCoordinateFrame="TransducerOriginPixel"
  />

</PlusConfiguration>
