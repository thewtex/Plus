SET( TestDataDir ${PLUSLIB_DATA_DIR}/TestImages )
SET( ConfigFilesDir ${PLUSLIB_DATA_DIR}/ConfigFiles )

#***************************  vtkVolumeReconstructorTest1  ***************************
ADD_EXECUTABLE(vtkVolumeReconstructorTest vtkVolumeReconstructorTest1.cxx )
TARGET_LINK_LIBRARIES(vtkVolumeReconstructorTest vtkVolumeReconstruction )

# Reconstruct a volume from brachy stepper acquisition
ADD_TEST(vtkVolumeReconstructorTest1
  ${EXECUTABLE_OUTPUT_PATH}/vtkVolumeReconstructorTest
  --input-config-file-name=${ConfigFilesDir}/Test_PlusConfiguration_VolumeReconstructionOnly_SonixRP_TRUS_D70mm.xml 
  --input-img-seq-file-name=${TestDataDir}/USTC_Ulterius_ProbeTranslationData.mha
  --output-volume-file-name=vtkVolumeReconstructorTest1Output.vtk
  --input-transform-name=ProbeToReferenceTransform
  )
SET_TESTS_PROPERTIES( vtkVolumeReconstructorTest1 PROPERTIES FAIL_REGULAR_EXPRESSION "ERROR;WARNING" )

# Reconstruct a volume from freehand acquisition
ADD_TEST(vtkVolumeReconstructorTest2
  ${EXECUTABLE_OUTPUT_PATH}/vtkVolumeReconstructorTest
  --input-config-file-name=${TestDataDir}/NwirePhantomFreehand.xml 
  --input-img-seq-file-name=${TestDataDir}/NwirePhantomFreehand.mha
  --output-volume-file-name=vtkVolumeReconstructorTest2Output.vtk
  --input-transform-name=ProbeToReferenceTransform
  )
SET_TESTS_PROPERTIES( vtkVolumeReconstructorTest2 PROPERTIES FAIL_REGULAR_EXPRESSION "ERROR;WARNING" )

# Compare reconstructed freehand volume (generated by vtkVolumeReconstructorTest2) with the reference volume
ADD_TEST(vtkVolumeReconstructorTest3
  ${CMAKE_COMMAND} -E compare_files 
  ${TestDataDir}/NwirePhantomFreehandReconstructed.vtk
  vtkVolumeReconstructorTest2Output.vtk
  )
SET_TESTS_PROPERTIES(vtkVolumeReconstructorTest3 PROPERTIES DEPENDS vtkVolumeReconstructorTest2)


#***************************  CreateSliceModels  ***************************
# This program helps debugging geometry problems in volume reconstruction.
ADD_EXECUTABLE( CreateSliceModels CreateSliceModels.cxx )
TARGET_LINK_LIBRARIES( CreateSliceModels vtkPlusCommon vtkVolumeReconstruction )
ADD_TEST(CreateSliceModelsTest 
  ${EXECUTABLE_OUTPUT_PATH}/CreateSliceModels
  --input-metafile=${TestDataDir}/NwirePhantomFreehand.mha
  --output-modelfile=GeneratedSliceModels.vtk  
  --input-configfile=${TestDataDir}/NwirePhantomFreehand.xml 
  --input-transform-name=ProbeToReferenceTransform
  )
SET_TESTS_PROPERTIES( CreateSliceModelsTest PROPERTIES FAIL_REGULAR_EXPRESSION "ERROR;WARNING" )
